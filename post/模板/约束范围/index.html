<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="王水泥">


    <meta name="subtitle" content="技术，etc">


    <meta name="description" content="不要传播">



<title>MD read me | 王水泥个人博客</title>



    <link rel="icon" href="/blog/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/blog/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/blog/js/script.js"></script>
    
    <script src="/blog/js/tocbot.min.js"></script>
    




<meta name="generator" content="Hexo 5.4.2"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/blog/">王水泥的博客</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/blog/archives">Posts</a>
                
                    <a class="menu-item" href="/blog/category">Categories</a>
                
                    <a class="menu-item" href="/blog/tag">Tags</a>
                
                    <a class="menu-item" href="/blog/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/blog/">王水泥的博客</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/blog/archives">Posts</a>
                
                    <a class="menu-item" href="/blog/category">Categories</a>
                
                    <a class="menu-item" href="/blog/tag">Tags</a>
                
                    <a class="menu-item" href="/blog/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">MD read me</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">王水泥</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">十一月 1, 2022&nbsp;&nbsp;16:23:33</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/blog/categories/%E6%A8%A1%E6%9D%BF/">模板</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <p>为了方便编码，易于理解，提高效率，统一管理，特出此文档来规范约束<code>强制</code>所有开发必须按照该文档所述而改进代码</p>
<h2 id="约束范围"><a href="#约束范围" class="headerlink" title="约束范围"></a>约束范围</h2><p>@(不太重要)</p>
<p>由于文档本身制作较晚，已经逼近2.5版本（2019.9.5），为了不会因为改动老代码而带来的新问题，特要求约束范围自2.5版本起<br>（包括2.5版本），而对于早于2.5版本的代码，要求相关业务负责人在空余时间进行改动、自测、提测。特别注意几大难点应该放在<br>最后且多人共同修改，如下</p>
<ul>
<li>Chat 聊天界面+相关辅助类</li>
<li>相机+相关辅助类</li>
<li>视频+相关辅助类</li>
</ul>
<h2 id="业务分类"><a href="#业务分类" class="headerlink" title="业务分类"></a>业务分类</h2><p>无论是Api Service还是VM都应按不同业务名、面向对象原则区分文件（弱耦合，高内聚）</p>
<p>而业务的区分按面向对象原则中的（is a&#x2F;like a）来进行区分。比如业务上嵌套了的post的评论，和post不属于同一业务。</p>
<h2 id="开发须知"><a href="#开发须知" class="headerlink" title="开发须知"></a>开发须知</h2><h3 id="1-新页面开发注意"><a href="#1-新页面开发注意" class="headerlink" title="1. 新页面开发注意"></a>1. 新页面开发注意</h3><p>在设计开发一个新页面的时候，优先使用Fragment而不是Activity。当要开发的页面具有特异性（业务无关性）的时候，应当优先使用Activity，如</p>
<ul>
<li>扫描二维码页面</li>
<li>相机&#x2F;拍照页面</li>
<li>视频处理页面</li>
<li>聊天页面</li>
<li>文件（图片）选择器</li>
<li>闪屏页&#x2F;Splash</li>
<li>首页&#x2F;homepage</li>
</ul>
<blockquote>
<p>在所有封装的Base里，如无特殊原因，必须使用app\src\main\java\com\owoh\ui\basenew包下的OwohActivity、OwohFragment、OwohListFragment</p>
</blockquote>
<h3 id="2-Base类的使用"><a href="#2-Base类的使用" class="headerlink" title="2. Base类的使用"></a>2. Base类的使用</h3><ul>
<li>所有的基类已经实现了MVVM&lt;V,VM&gt;、View.OnClickListener</li>
<li>调用setVisibility(isVisibility: Boolean, vararg views: View)来设置views的显示和隐藏</li>
<li>调用registerSafeListener批量设置view.setSafeClickListener，再通过重写onClick()方法来实现逻辑</li>
<li>设置needEventBus&#x3D;true，自动在父类对EventBus进行注册销毁。子类不要重复添加</li>
<li>跳转使用com.owoh.ui.basenew.go()方法，所有传参一律手动添加到IntentDto中传输，不许额外传输。<code>暂时没有写activity之间的跳转，但逻辑一样</code></li>
<li>对应的跳转过去后，dto:IntentDto已经被实例化（onCreate()&#x2F;onViewCreate()后），可以直接取用。</li>
<li>binding可以在onCreate()&#x2F;onViewCreate()后直接使用，非空。</li>
</ul>
<p>对于Fragment（包含以上全部）</p>
<ul>
<li>act全局变量可以在onAttach()后直接使用，非空，类型BaseFragmentActivity</li>
</ul>
<p>对于ListFragment（包含以上全部）</p>
<ul>
<li>它默认有实现界面R.layout.owoh_list_fragment，如果你的业务界面符合请勿重开界面</li>
<li>构造listFragment的时候可以通过布局xml给RefStateView传入item或头部或其他状态layout，也可以重写getItemLayoutId()和getHeadLayoutId（）</li>
<li>bindHeader(…)和bindData(…)可以让你处理头部和每个item的逻辑</li>
<li>canLoadDataOnViewCreated可以设置是否在执行onViewCreated（）时调用子类的加载</li>
</ul>
<p>关于Dialog和PopWindow的基类还未实现</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/e588d74b5c9f">Dialog和PopUpWindow的抉择</a></p>
</blockquote>
<h3 id="3-BarView的使用"><a href="#3-BarView的使用" class="headerlink" title="3. BarView的使用"></a>3. BarView的使用</h3><p>由于现在已经是9102年了，所有在潮流内的app都必须去控制和利用状态栏，所以就有了BarView，它也可以让图片本身顶到手机屏幕的最高处成为状态栏的背景，<br>所以既然组件已经实现，就要求普通Ui设计的情况下，<code>必须所有布局xml都要使用BarView来利用状态栏。</code></p>
<ul>
<li>xml本身是树形结构，BarView必须为以深度优先算法遍历View Tree的第一个叶子（View）节点</li>
<li>BarView分为左边两个ImageView，右边两个ImageView，右边一个TextView，中间一个Title和一个SubTitle，底部一个分割线，这些属性设置请自行去看代码</li>
<li>backgroundColor、dividerColor、showBottomDivider顾名思义，但是backgroundColor会同时改变状态栏的颜色</li>
<li>needFitStatusBar默认为true，设置为false时，状态栏的颜色不会更随backgroundColor而改变</li>
<li>onlyNeedFitStatusBar默认为false，设置为true时，BarView不可见（高度为1px），但是状态栏依然会被BarView控制，因此可以让其他图片顶到状态栏上去</li>
<li>$ titleHeight &#x3D; BarView.Height - StateBar.Height $ <code>这种方式虽然没问题，但是不符合自定义View的设置，需优化</code></li>
</ul>
<h3 id="4-工具类"><a href="#4-工具类" class="headerlink" title="4. 工具类"></a>4. 工具类</h3><p>由于第三方工具库已经足够强大，通常情况下是不需要重新造轮子的。</p>
<ul>
<li><p>工具库：所有开发应详细阅读<a target="_blank" rel="noopener" href="https://github.com/Blankj/AndroidUtilCode/blob/master/lib/utilcode/README-CN.md">AndroidUtilCode中文介绍</a>，因为你要写的工具类的80%它都实现了</p>
</li>
<li><p>UI库：<a target="_blank" rel="noopener" href="https://github.com/Tencent/QMUI_Android">QMUI_Android</a>，要小心使用这个UI库，因为它本身是一个工程，被各种res和style等所链接起来，所以很重，不可以直接粘贴出来用，但是其他第三方又没他做的好。<br>所以在未来，如果可以舍弃或者替换，还是应该替换掉它。</p>
</li>
<li><p>本地化存储：<a target="_blank" rel="noopener" href="https://github.com/Tencent/MMKV">MMKV</a>,由于MMKV是protobuf的一种实现，也是未来序列化数据最新的方式，所以它又快又小，中途发现过两个比较严重的bug都在更新版本后解决了，现在还遗留着Alex的华为<br>手机貌似不能存取的问题。在测试没有手机有问题后，应该去除掉所有的SP。并且在实际开发中，应该将同种类或同业务的key以对象的形式分类存储。</p>
<p align="left">
  <img src="https://github.com/Tencent/MMKV/wiki/assets/profile_android_mini.jpg" height="100">
</p>
</li>
<li><p>如果mmkv满足不了你，应该用工具库中的IOFIle类来写文件，或者用kotlin的file.writeText()这些都相对于你自己写文件更简单，且不会有一堆垃圾代码</p>
</li>
<li><p>权限的管理一律使用com.owoh.util.PermissionUtils()类</p>
</li>
<li><p>打开相册选取图片或视频一律使用com.owoh.camera.GalleryUtils()类</p>
</li>
<li><p>倒计时使用CountDownTimerManager然后实现接口即可，但是CountDownTimerManager会将倒计时保存到本地，直到为0为止。</p>
</li>
<li><p>业务无关的常量（const val）应该统一写到 Constant.kt中 <code>但是当前的Constant需要优化</code></p>
</li>
<li><p>头像的显示和点击跳转使用com.owoh.util.onHeadClick(…)</p>
</li>
<li><p>图片（头像、大图、背景图、高斯模糊图）应该使用com.owoh.util.BindingUtils.kt<code>对默认图的设置不是很友好，需要思考如何优化</code></p>
</li>
<li><p>登陆用户（判断是否登陆，userId等）请使用prefs.loginUser方法</p>
</li>
<li><p>默认头像：svg_def_head.xml 默认背景图：svg_def_bg.xml</p>
</li>
</ul>
<h3 id="5-自定义View"><a href="#5-自定义View" class="headerlink" title="5. 自定义View"></a>5. 自定义View</h3><ul>
<li>IconButton4 设置好多种状态下button的样式，然后动态的改变状态</li>
<li>RowView 默认的行显示，可控的分割线，可以动态设置右侧的内容</li>
<li>EditTextCount 右下角会显示 1&#x2F;100的编辑框</li>
<li>RefStateView ListFragment里的下拉刷新View 这次写的比以往都简单了很多很多，所以如果再说太复杂看不懂代码那就切腹自尽去吧</li>
</ul>
<h2 id="6-资源命名"><a href="#6-资源命名" class="headerlink" title="6. 资源命名"></a>6. 资源命名</h2><p>由于资源的位置不像代码文件可以分包，所以资源名字里多少都有和分包有关的内容信息，比如业务。<br>我们app用的是sourceSets.main.res.srcDirs配置资源分包方式，即使如此，几乎所有的资源一律要标记<strong>我是谁，属于谁，从哪里来，长什么样，用来做什么等</strong></p>
<h3 id="1-国际化"><a href="#1-国际化" class="headerlink" title="1. 国际化"></a>1. 国际化</h3><p>app中的strings.xml是对<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/I18N">国际化（i18n）</a>的一种实现。<br>而i18n的意思是internationalization中的 i+18个中间字母+n。所以你要明白，在资源命名里，包括类名，都是要尽可能的表达完整哪怕牺牲长度，但是国际化并不是这样的，它要求表达到位就行，<br>详情参照<a target="_blank" rel="noopener" href="https://developer.android.com/distribute/marketing-tools/localization-checklist.html?hl=zh-cn#manage-strings">android开发者中文站</a>所以字符串本身的key不应该加业务进去，<br>它是脱离业务而存在的，但却可以像developer.android.com描述的那样，说清楚字符串的上下文。举个例子</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;ok&quot;</span>&gt;</span>ok<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;pet_ok&quot;</span>&gt;</span>ok<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;user_ok&quot;</span>&gt;</span>ok<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;post_ok&quot;</span>&gt;</span>ok<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;btn_ok&quot;</span>&gt;</span>ok<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面的翻译明显中间的加了业务不如不加业务，反而加了业务会让你感觉怪异，再如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;pet_detail&quot;</span>&gt;</span>宠物详情<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;detail_of_pet&quot;</span>&gt;</span>宠物详情<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;title_pet_detail&quot;</span>&gt;</span>宠物详情<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;pet&quot;</span>&gt;</span>宠物详情<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;detail&quot;</span>&gt;</span>宠物详情<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面的翻译我保证你不知道它是用来做什么的，直到你看到了“title”你才会明白这个翻译的用处是放到title中，而detail_of_pet不如pet_detail，因为因为我们的大脑可以很自然的理解pet_detail表达的是pet’s detail的意思，这就够了，detail_of_pet只能是多此一举，而后两个完全表达不明。<br>所以优先选择title_pet_detail（再说一遍，title是上下文，并不是业务），其次可以选择pet_detail，剩下的不需要选择。最后一个例子</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 100人 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;people&quot;</span>&gt;</span>%1$d人<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;p&quot;</span>&gt;</span>%1$d人<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;people_&quot;</span>&gt;</span>%1$d人<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 种类:人 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;people&quot;</span>&gt;</span>人<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;p&quot;</span>&gt;</span>人<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;people_&quot;</span>&gt;</span>人<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>最后当翻译是一个<strong>单位</strong>的时候，直译会和非单位的直译重叠，这种状况包括<strong>key 和 key:</strong>,这种情况下，选第二个p对谁都不合适，而我个人更倾向于key_这种方式用来表达单位和头尾部带特殊符号的，所以我个人觉得，用people表达人用people_表达%1$d人更合适，所以总结一下</p>
<blockquote>
<p>总结：无论什么情况下，key中包含业务并不能让它更好。类似于单位，或者key:这种类型，也包括<strong>ok</strong>这种极其简单的翻译，甚至也不要包含上下文，也不会有人把OK这种东西放在title这种高度，因为它仅仅是一个文字而已，如果非要加上下文，千万不要给单位加，只需要给单位的key中加特殊符号即可。<br>剩下的其他类型越具有特异性的，key就应该表达的越详细。类似于省市区定位法</p>
</blockquote>
<h3 id="2-svg图"><a href="#2-svg图" class="headerlink" title="2. svg图"></a>2. svg图</h3><p>所有的简略图标都应该以svg导入到工程中，而不是用一堆png，而在导入之前应该先看工程中是否有同样的文件，因为svg只能用开发工具看图，所以每个开发应该挨个点击一遍观看，来加入记忆。<br>而svg本身也是业务无关的。所以命名规则为：</p>
<blockquote>
<p>svg_(1符号样式&#x2F;2功能)_(1最多看到的颜色&#x2F;2主题色) 如svg_plus_gray_n(0-n)</p>
</blockquote>
<p>但是有特殊情况，比如svg_btn它只用来做按钮的背景，这时候它就是上下文有关。所以如果上面的解决不了问题或特异性严重，最多可以像下面这样命名，</p>
<blockquote>
<p>svg_(上下文)_ (1符号样式&#x2F;2功能)_(样式矢量等) _(1最多看到的颜色&#x2F;2主题色) 如svg_btn_arrow_left_blue_n(0-n)</p>
</blockquote>
<h3 id="3-drawable和mipmap"><a href="#3-drawable和mipmap" class="headerlink" title="3. drawable和mipmap"></a>3. drawable和mipmap</h3><p>drawable和mipmap的命名相当于把svg命名前面的svg换成业务即可,<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ecf007710fae">drawable和mipmap的区别</a></p>
<h3 id="4-自定义view的values"><a href="#4-自定义view的values" class="headerlink" title="4. 自定义view的values"></a>4. 自定义view的values</h3><p>自定义的values不建议放到工程的attrs.xml，id.xml,styles.xml，strings.xml,color.xml…中，比如attrs.xml，最好是新建文件attrs_xxx_view.xml,这么做的好处是易拓展，灵活，能最少的产生垃圾代码。在Android版本迭代的时候，能最少的和工程保持对齐。也就是说的高内聚。</p>
<h3 id="5-layout命名"><a href="#5-layout命名" class="headerlink" title="5. layout命名"></a>5. layout命名</h3><ul>
<li>由于fragment_xxx和activity_xxx过于范化，所以我认为可以不写，直接写成 业务_子业务_上下文_状态&#x2F;模式</li>
<li>所有的adapter的item 一律在上面的基础上加 item_前缀</li>
<li>头部加header_前缀</li>
<li>自定义view加view_前缀</li>
<li>dialog加 dialog_前缀</li>
<li>pop加 pop_前缀<blockquote>
<p>多个类似名称的文件，在不破坏语义的前提下，应当将越相同的部分越往前排,特别相同且不分状态的可以在尾部追加0~n</p>
</blockquote>
</li>
</ul>
<h3 id="layout中的id命名"><a href="#layout中的id命名" class="headerlink" title="layout中的id命名"></a>layout中的id命名</h3><blockquote>
<p>一律使用驼峰的方式，禁用下划线</p>
</blockquote>
<h2 id="类-x2F-方法命名"><a href="#类-x2F-方法命名" class="headerlink" title="类&#x2F;方法命名"></a>类&#x2F;方法命名</h2><h3 id="1-类命名"><a href="#1-类命名" class="headerlink" title="1. 类命名"></a>1. 类命名</h3><p>UI类如：Fragment、Activity，这些的。个人建议，如果包是按大类型分包（如MVVM模式），则可以省去共同字，<em><strong>Fragment、</strong></em>Activity，类似于layout，如果是根据业务分包，那么还是不要省去的好，这两种方式都是为了在特定情况下便于搜素，减少混淆。<br>所以一般情况下，命名应该为Business+Detail&#x2F;List&#x2F;Tab+Activity&#x2F;Fragment,按步数的可以加入Step1、Step2…，按嵌套层级来的可以加入Level1、Level2…，有一种特殊一点的UI类，他对应的是一个ViewPager，这种类应该命名为Tab，如果嵌套层级只有两层且互为子母关系，可以将子类加Sub前缀</p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/39651928">简单对象类</a>：</p>
<ul>
<li>为了避免和java里产生混淆，应该规避’Bean’</li>
<li>为了避免和Android里的设计模式中的Model产生混淆，应规避’Model’</li>
<li>为了避免和Spring里的VO产生混淆，应规避’VO’</li>
<li>为什么不用Entries？讲真我觉得和其他的*Object类感觉并不是一类的，再者说，这种简单对象其实怎么都可以，我觉得简单就好。</li>
<li>在kotlin中，这种简单对象可以按业务放在不同的Bos.kt中，也可以全部放在一个文件中。</li>
</ul>
<p>辅助类&#x2F;工具类：无论你用MVP还是用MVVM其实都缺不了辅助类，最形象的就是IM中的IMHelper或者曾经的DBHelper辅助类提供一堆高内聚的方法，这种类只辅助一种业务&#x2F;上下文，给我入参，返回回参。这种类一般不需要去看内部实现，只需要知道有多少个方法都是用来做什么的就行。<br>这种类的命名方式应该为 业务&#x2F;上下文+Helper&#x2F;Tools&#x2F;Utils&#x2F;Control…具体选哪一个，要看其做的事情。有时候辅助类就是工具类，比如FileUtils，不用太纠结。</p>
<p>interface:interface本身如果是业务相关的，在kotlin中，那就应该把业务相关的interface放入到一个kt文件中，然后文件命名为L.kt，简单方便。需要注意的是，类名后缀可能是Impl或者Listener或者Interface，这个要根据其作用来区分。如果是充当监听者的角色，则用Listener</p>
<p>其他：常见的如Business+Adapter，Business+VM，Business+Constant等。在kotlin中，应该把业务相关的Constant集合在其他UI类里用const val修饰。而非业务相关的应该放在核心包下且只存在一份，如果每个业务下都有自己的constant，应该在最外层的核心包下建立一个Global.kt<br>存放业务无关的constant。</p>
<h3 id="2-方法命名"><a href="#2-方法命名" class="headerlink" title="2. 方法命名"></a>2. 方法命名</h3><p>方法命名一般变得是前缀和后缀，中间都是业务。前缀一般为：get&#x2F;set&#x2F;is&#x2F;if&#x2F;upload&#x2F;update&#x2F;clear&#x2F;drop&#x2F;reset&#x2F;show…etc，其无论怎么命名，要表达清楚方法的意义：该方法得到什么？&gt;该方法做什么？&gt;该方法有什么意义?&gt;该方法要什么…，</p>
<blockquote>
<p>方法名字取得好是不需要注解的，但是无论如何，牵扯到大量逻辑计算，或者数学表达式的方法，必须要注解清楚。</p>
</blockquote>
<h2 id="Koltin"><a href="#Koltin" class="headerlink" title="Koltin"></a>Koltin</h2><p><a target="_blank" rel="noopener" href="https://www.kotlincn.net/docs/tutorials/">Official Kotlin Tutorials</a></p>
<p><a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/reference/coding-conventions.html">Official Kotlin Coding Conventions</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/raywenderlich/kotlin-style-guide">Kotlin Code Style Guide</a></p>
<p><a target="_blank" rel="noopener" href="https://phauer.com/2017/idiomatic-kotlin-best-practices/">Kotlin Best Practices</a></p>
<p><a target="_blank" rel="noopener" href="https://phauer.com/2017/clean-code-kotlin/">Clean Code for Kotlin</a></p>
<p>强制要求用kotlin进行开发，除第三方引用外。所以必须要掌握kotlin的基础用法。比如常见的</p>
<ul>
<li>String.subString***</li>
<li>callback:()-&gt;Unit</li>
<li>listOf() mutableListOf()</li>
<li>if(list<A> &#x3D;&#x3D; list<B>)</li>
<li>list<B> &#x3D; list<A>.convert{ A-&gt;B }</li>
<li>when()</li>
<li>慎用断言(!!),用if(obj&#x3D;&#x3D;null) return 后面的obj都是非空</li>
<li>apply{} let{} run{}</li>
<li>A&#x3D;B.copy(part) 可以让你得到一个引用不同的对象，除非设置入参不同，否则其他参数都一样的对象</li>
<li>etc</li>
</ul>
<p>再比如各种bo文件的setter和getter，业务相关性的func()，这些都需要自己去学习，看代码，问同事。</p>
<h2 id="插件使用"><a href="#插件使用" class="headerlink" title="插件使用"></a>插件使用</h2><blockquote>
<p>由于最近在研究插件UI，所以想搞定UI后一次性把功能全放进来。</p>
</blockquote>
<h3 id="1-i18n转换"><a href="#1-i18n转换" class="headerlink" title="1. i18n转换"></a>1. i18n转换</h3><p>工程下的apollo.jar可以把table.tsv转换成strings.xml，由于插件申请很麻烦，且我还有很多插件UI没有开发，所以目前请各位开发手动安装本地插件。</p>
<p>使用方法：将<a target="_blank" rel="noopener" href="https://docs.google.com/spreadsheets/d/1oZPRlp8nWevfWxTGS75T6miaW7FPKodEp-piMNmffgQ/edit#gid=0">google文档</a>改完后，下载到本地（c&#x2F;user&#x2F;download or 桌面 or 工程根目录下）插件会找出最新的.tsv文件，然后生成string覆盖strings.xml</p>
<h3 id="2-API-Service-自动生成"><a href="#2-API-Service-自动生成" class="headerlink" title="2. API Service 自动生成"></a>2. API Service 自动生成</h3><blockquote>
<p>该插件暂不介绍，已开发完毕，还在beta阶段。</p>
</blockquote>
<h3 id="3-Fragment-amp-VM-amp-layout-amp-Bo自动生成"><a href="#3-Fragment-amp-VM-amp-layout-amp-Bo自动生成" class="headerlink" title="3 Fragment &amp; VM &amp; layout &amp; Bo自动生成"></a>3 Fragment &amp; VM &amp; layout &amp; Bo自动生成</h3><blockquote>
<p>该插件暂不介绍，还未开发，前提是所有的基类必须统一</p>
</blockquote>
<h2 id="Gradle管理"><a href="#Gradle管理" class="headerlink" title="Gradle管理"></a>Gradle管理</h2><blockquote>
<p>该插件暂不介绍</p>
</blockquote>
<h2 id="GitLab-CI-x2F-CD-的使用"><a href="#GitLab-CI-x2F-CD-的使用" class="headerlink" title="GitLab CI &#x2F; CD 的使用"></a>GitLab CI &#x2F; CD 的使用</h2><h4 id="1-自动-build-机制"><a href="#1-自动-build-机制" class="headerlink" title="1. 自动 build 机制"></a>1. 自动 build 机制</h4><p>现时暂时只会以下规范的 branch 才会自动触发 GitLab CI&#x2F;CD 自动 build 一次</p>
<ul>
<li>master</li>
<li>develop</li>
<li>feature-* (feature-matching, feature-v2.5 …)</li>
</ul>
<h4 id="2-自动生成-APK-机制"><a href="#2-自动生成-APK-机制" class="headerlink" title="2. 自动生成 APK 机制"></a>2. 自动生成 APK 机制</h4><p>如果要自动生产APK的话，一定要经过创建规范的 tag 的方式来执行，规范为以下条件:</p>
<ul>
<li>uat-* (uat，为uat版本，可以不断创建tag)</li>
<li>pre-rel-* (pre-release，为非正式上线版本，可以不断创建tag)</li>
<li>release-* (release，为正式上线版本，tag不能胡乱创建, 只有admin才能创建)</li>
</ul>
<p>以版本为 v2.5.0 为例，如你想建立 pre-rel-* 的 APK，那么 tag 的命名方法就会是这样</p>
<blockquote>
<p>第一次为 pre-rel-v2.5.0.0，如有新代码需要生成新APK，由于tag的名字是不能重覆的，第二次再生成则为 pre-rel-v2.5.0.1，如此類推</p>
</blockquote>
<h2 id="Todo-list"><a href="#Todo-list" class="headerlink" title="Todo list"></a>Todo list</h2><ul>
<li>尝试用kotlin作为DSL<code>禁止这么做，经过实验，kotlin写DSL非常麻烦且复杂，而且支持的也不够</code></li>
<li>架构链式反应 1 语言切换 反应链2 跳转反应链3 统计链</li>
<li>制作loading栈，确保同一时刻只有一个loading<code>已完成</code></li>
<li>prefs中的所有相同类型的key转成对象</li>
<li>去除完整包名路径</li>
<li>所有的string?:””改成string.orEmpty()</li>
<li>闪屏页速度优化</li>
<li>集中处理所有的红点</li>
<li>推送升级？是否必要？</li>
<li>监听网络状态</li>
<li>增加热更新</li>
<li>集中管理所有的占位图</li>
<li>统一baseAct<code>已完成</code></li>
<li>缺少 dialog和pop的base<code>已完成</code></li>
<li>尝试点赞和关注和view相关</li>
<li>封装弱引用</li>
<li>大多自定义view有问题</li>
</ul>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>王水泥</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://king-of-cement.gitee.io/blog/post/%E6%A8%A1%E6%9D%BF/%E7%BA%A6%E6%9D%9F%E8%8C%83%E5%9B%B4/">http://king-of-cement.gitee.io/blog/post/%E6%A8%A1%E6%9D%BF/%E7%BA%A6%E6%9D%9F%E8%8C%83%E5%9B%B4/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY</strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/blog/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/blog/post/view/%E9%AB%98%E7%BA%A7UI/">高级UI</a>
            
            
            <a class="next" rel="next" href="/blog/post/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/">网络通信</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© 王水泥 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>